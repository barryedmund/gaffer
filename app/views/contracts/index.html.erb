<% league = League.find_by_id(params[:league_id]) %>
<div class="row">
	<div class="col-sm-12">
		<div class="demo-card-wide mdl-card mdl-shadow--2dp">
			<div class="mdl-card__title">
        <h2 class="mdl-card__title-text">
        	<%= link_to league.name, league_path(league), class: "content-link" %>
        	<span>&nbsp;contract offers</span>
        </h2>
      </div>
      <div class="mdl-card__supporting-text">
      	These are sorted by player & then by contract value (salary x length). Once a player is offered a contract, other teams have two days to beat it.
      </div>
      <div class="mdl-card__supporting-text">
        <ul class="horizontal-style">
          <li><%= link_to 'Offer free agent a contract', new_league_contract_path(league.id), class: "mdl-button--primary" %></li>
        </ul>
      </div>
    </div>
    <div class="demo-card-wide mdl-card mdl-shadow--2dp">
      <div class="mdl-card__actions">
      	<% pending_contracts = @contracts.joins(:player).where(signed: false).sort_by {|contract| [contract.player.last_name, contract.player.pl_player_code, -contract.value, contract.created_at] } %>
      	<% if pending_contracts.count > 0 %>
      		<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
						<tr>
							<th class="mdl-data-table__cell--non-numeric">
								<span>Player</span>
							</th>
							<th class="mdl-data-table__cell--non-numeric">
								<span>Team</span>
							</th>
							<th>
								<span>Salary</span>
							</th>
							<th class="mdl-data-table__cell--non-numeric">
								<span>Start</span>
							</th>
						</tr>
	      		<% pending_contracts.each do |contract| %>
	      			<tr>
		      			<td class="mdl-data-table__cell--non-numeric normal-text">
		      				<%= contract.player.full_name(true) %>
		      			</td>
		      			<td class="mdl-data-table__cell--non-numeric normal-text">
		      				<%= truncate(contract.team.title, length: 13) %>
		      			</td>
		      			<td class="normal-text">
		      				<% if contract.team == @current_user.teams.joins(:league).where('leagues.id = ?', league.id).first %>
		      					<%= link_to number_to_currency(contract.weekly_salary_cents, precision: 0), edit_league_contract_path(league, contract), class: "content-link" %>
									<% else%>
										Private
									<% end %>
		      			</td>
		      			<td class="mdl-data-table__cell--non-numeric normal-text">
		      				<%= contract.starts_at.strftime("%d %b") %>
		      			</td>
	      			</tr>
	      		<% end %>
      		</table>
      	<% else %>
      		<div class="normal-text">
        		No pending contracts.
        	</div>
      	<% end %>
      </div>
    </div>
  </div>
</div>
